customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.sampleButton=this.querySelector("[id^=SampleOrderButton]"),this.sampleButton?.addEventListener("click",this.onSampleSubmitHandler.bind(this)),this.form.querySelector("[name=id]").disabled=!1,this.querySelector('[type="submit"]')?.addEventListener("click",this.onSubmitHandler.bind(this)),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.submitButtons=this.querySelectorAll(".product-form__submit"),document.querySelector("cart-drawer")&&this.submitButtons.forEach(t=>t.setAttribute("aria-haspopup","dialog")),this.hideErrors="true"===this.dataset.hideErrors}setToLoading(){this.submitButtons.forEach(t=>{t.setAttribute("aria-disabled",!0),t.classList.add("loading"),t.querySelector(".loading-overlay__spinner").classList.remove("hidden")})}sendRequest(r,s,t){fetch(""+routes.cart_add_url,t).then(t=>t.json()).then(t=>{var e;if(t.status)return publish(PUB_SUB_EVENTS.cartError,{source:"product-form",productVariantId:s.get("id"),errors:t.description,message:t.message}),this.handleErrorMessage(t.description),(e=r.target.querySelector(".sold-out-message"))?(this.submitButtons.forEach(t=>{t.setAttribute("aria-disabled",!0),t.querySelector("span").classList.add("hidden")}),e.classList.remove("hidden"),void(this.error=!0)):void 0;this.cart?(this.error||publish(PUB_SUB_EVENTS.cartUpdate,{source:"product-form",productVariantId:s.get("id")}),this.error=!1,e=this.closest("quick-add-modal"),t.items&&(t.items[0].sections=t.sections,t=t.items[0],r.target==this.sampleButton)&&(r.target.querySelector("span > span").textContent="Added to Cart",r.target.setAttribute("disabled",!0)),e?(document.body.addEventListener("modalClosed",()=>{setTimeout(()=>{this.cart.renderContents(t)})},{once:!0}),e.hide(!0)):this.cart.renderContents(t)):window.location=window.routes.cart_url}).catch(t=>{console.error(t)}).finally(()=>{this.submitButtons.forEach(t=>{t.classList.remove("loading"),this.error||t.removeAttribute("aria-disabled"),t.querySelector(".loading-overlay__spinner").classList.add("hidden")}),this.cart&&this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty"),this.updateCartIcon()})}onSampleSubmitHandler(t){var e,r,s;t.preventDefault(),null!=t.target.getAttribute("data-value")&&"true"!==t.target.getAttribute("aria-disabled")&&((e=fetchConfig("javascript")).headers["X-Requested-With"]="XMLHttpRequest",this.handleErrorMessage(),this.setToLoading(),r=new FormData,s={items:[{id:t.target.getAttribute("data-value"),quantity:1}]},this.cart&&(s.sections=this.cart.getSectionsToRender().map(t=>t.id),s.sections_url=window.location.pathname,this.cart.setActiveElement(document.activeElement)),r.append("items",[{id:t.target.getAttribute("data-value"),quantity:1}]),e.body=JSON.stringify(s),this.sendRequest(t,r,e))}onSubmitHandler(t){var e,r;t.preventDefault(),"true"!==t.target.getAttribute("aria-disabled")&&(this.handleErrorMessage(),this.setToLoading(),(e=fetchConfig("javascript")).headers["X-Requested-With"]="XMLHttpRequest",delete e.headers["Content-Type"],r=new FormData(this.form),this.cart&&(r.append("sections",this.cart.getSectionsToRender().map(t=>t.id)),r.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),e.body=r,this.sendRequest(t,r,e))}handleErrorMessage(t=!1){this.hideErrors||(this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!t),t)&&(this.errorMessage.textContent=t))}updateCartIcon(){fetch(routes.cart_url+"?section_id=custom-cart-counter").then(t=>t.text()).then(t=>{var e=document.querySelector("header");const r=(new DOMParser).parseFromString(t,"text/html").querySelector("#itemCount").textContent;e.querySelectorAll(".menu-item__name-cart").forEach(function(t,e){t.querySelector("#itemCount").textContent=r})}).catch(t=>{console.error(t)})}});
//# sourceMappingURL=product-form.min.js.map
