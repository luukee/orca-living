{% comment %}
  Section: Collection Value Props

  Displays a series of value propositions for a collection using metafield data.
  Each value prop consists of an image, title, and description in an alternating layout.

  Metafield Structure:
  - Namespace: custom.collection_value_props
  - Type: metaobject
  - Fields:
    - image: Image picker
    - title: Single line text
    - description: Multi line text

  Usage:
  1. Create metafield in Shopify Admin
  2. Add values to collection metafields
  3. Add this section to collection template
{% endcomment %}
{% assign value_props = collection.metafields.custom.collection_value_props.value %}

{% comment %}
  Check if we're on a tag/subcategory page for collections specified in settings
  Hide section on tag pages, only show on base collection URL
{% endcomment %}
{% assign is_tag_page = false %}
{% assign hide_on_subcategories = section.settings.hide_on_subcategories_collections | strip %}
{% if hide_on_subcategories != blank %}
  {% assign collections_to_hide = hide_on_subcategories | split: ',' %}
  {% for collection_handle in collections_to_hide %}
    {% assign collection_handle_trimmed = collection_handle | strip %}
    {% if collection.handle == collection_handle_trimmed %}
      {% assign collection_path = '/collections/' | append: collection_handle_trimmed | append: '/_' %}
      {% if request.path contains collection_path %}
        {% assign is_tag_page = true %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}

{% unless is_tag_page %}
<div
  class='page-width'
  {% if value_props == blank %}
    hidden
  {% endif %}
>
  {% comment %}
    Fetch value props from collection metafields
    Returns array of objects containing image, title, and description
  {% endcomment %}

  {% if value_props != blank %}
    <div class='value-props-grid'>
      {% comment %}
        Loop through each value prop
        Even items will have image on right, odd items on left
      {% endcomment %}
      {% for prop in value_props %}
        <div class='value-prop-item'>
          {% if prop.image != blank %}
            <div class='value-prop-image'>
              {% comment %}
                Image rendering with:
                - Lazy loading for performance
                - 800px width for quality
                - Portrait aspect ratio (4:5 ratio)
                - Alt text from title for accessibility
              {% endcomment %}
              {{
                prop.image
                | image_url: width: 800
                | image_tag: loading: 'lazy', alt: prop.title, width: 800, height: 1000
              }}
            </div>
          {% endif %}

          <div class='value-prop-content'>
            {% if prop.title != blank %}
              <h3 class='value-prop-title'>{{ prop.title }}</h3>
            {% endif %}

            {% if prop.description != blank %}
              <div class='value-prop-description'>{{ prop.description }}</div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

{% comment %}
  Styles:
  - Grid layout with alternating image positions
  - Responsive design (stacks on mobile)
  - Uses Shopify's color system with CSS variables
  - Maintains square aspect ratio for images
{% endcomment %}
{% if value_props != blank %}
  <style>
    .value-props-grid {
      display: grid;
      gap: 8rem;
      margin: 4rem 0;
    }

    .value-prop-item {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      align-items: center;
    }

    /* Alternate image position for even items */
    .value-prop-item:nth-child(even) {
      direction: rtl;
    }

    /* Reset text direction for content in even items */
    .value-prop-item:nth-child(even) .value-prop-content {
      direction: ltr;
    }

    .value-prop-image {
      aspect-ratio: 4/5;
      overflow: hidden;
    }

    .value-prop-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .value-prop-content {
      text-align: left;
      padding: 2rem;
    }

    .value-prop-title {
      margin: 0 0 1rem;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .value-prop-description {
      line-height: 1.6;
      color: rgba(var(--color-foreground), 0.75);
    }

    /* Mobile styles */
    @media screen and (max-width: 749px) {
      .value-prop-item {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .value-prop-item:nth-child(even) {
        direction: ltr;
      }

      .value-prop-content {
        padding: 1rem 0;
      }
    }
  </style>
{% endif %}
{% endunless %}

{% schema %}
{
  "name": "Collection Value Props",
  "class": "collection-value-props",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Columns on desktop",
      "options": [
        {
          "value": "2",
          "label": "2 columns"
        },
        {
          "value": "3",
          "label": "3 columns"
        },
        {
          "value": "4",
          "label": "4 columns"
        }
      ],
      "default": "3"
    },
    {
      "type": "header",
      "content": "Visibility"
    },
    {
      "type": "text",
      "id": "hide_on_subcategories_collections",
      "label": "Hide on subcategories for collections",
      "info": "Enter collection handles (comma-separated) where value props should be hidden on tag/subcategory pages. Example: accessories, furniture. Value props will still show on base collection URLs.",
      "placeholder": "accessories, furniture"
    }
  ],
  "presets": [
    {
      "name": "Collection Value Props"
    }
  ]
}
{% endschema %}