{% comment %} This should be the id from the list not form {% endcomment %}
{% assign formId = 'TRRqph' %}

{% assign title = product.selected_or_first_available_variant.title %}
{% if title == 'Default Title' %}
  {% assign title = product.title %}
{% endif %}

<div class="out-of-stock {{class}}">
  <form
    id="{{formId}}"
    class="klaviyo_gdpr_embed_{{formId}} newsletter-form"
    action="//manage.kmail-lists.com/subscriptions/subscribe"
    data-ajax-submit="//manage.kmail-lists.com/ajax/subscriptions/subscribe"
    method="GET"
    target="_blank"
    novalidate="novalidate"
  >
    <div class="waitlist-form">
      <h5>Join Waitlist</h5>
      <div>
        <div class="input_wrapper">
          <input type="hidden" name="$fields" value="variantName">
          <input type="hidden" name="variantName" value="{{title}}">

          <input type="hidden" name="g" value="{{formId}}">
          <span class="visually-hidden label-hidden" for="k_id_email_footer">BackInStock Sign Up</span>
          <input
            type="email"
            name="email"
            id="k_id_email_footer"
            placeholder="Email Address"
          >
          <button type="submit">
            {% render 'icon-caret' %}
          </button>
        </div>
        <div class="klaviyo_messages">
          <div class="success_message form-message form-message--success" style="display:none;">
            Thank you. We'll let you know when it's back in stock.
          </div>
          <div class="error_message form-message form-message--error" style="display:none;">
            We're Sorry! Something went wrong!
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<script type="text/javascript" src="//www.klaviyo.com/media/js/public/klaviyo_subscribe.js"></script>
<script type="text/javascript">
  lnkDelay = '200'; // Amount of time between Checks
  var lnkExist = setInterval(function () {
    lnkObject = $('link[href*="klaviyo_subscribe.css"]');
    if (lnkObject.length) {
      clearInterval(lnkExist);
      setTimeout(function () {
        lnkObject[0].disabled = true;
        console.log('Disabled Conflicting Styles');
      }, 50);
    }
  }, lnkDelay);
  KlaviyoSubscribe.attachToForms('#{{formId}}', {
    hide_form_on_success: true,
    custom_success_message: true,
    error: function ($form) {
      console.log('failure?');
      console.log($form);
    },
    success: function ($form) {
      console.log('CALLED');
    },
  });
</script>
