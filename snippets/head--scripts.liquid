<!-- snippets/head--scripts -->

<script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'details-modal.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'search-form.js' | asset_url }}" defer="defer"></script>
{%- if settings.cart_type == "dropdown" -%}
  <script src="{{ 'cart-drawer.js' | asset_url }}" defer="defer"></script>
{%- endif -%}
{%- if settings.enable_country_selector or settings.enable_language_selector -%}
  <script src="{{ 'localization-form.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

<script type="text/javascript">
  // if functions are still firing too quickly
  function waitForJavascript(method) {
    if (window.jQuery && typeof pluginJSisLoaded !== 'undefined') {
      // document.addEventListener("DOMContentLoaded", function() {
      method();
      // })
    } else {
      setTimeout(function () {
        waitForJavascript(method);
      }, 50);
    }
  }
  // wrap your jquery in this.
  waitForJavascript(function () {
    // do stuff
  });
</script>

{% capture cust %}{% if customer %}{{customer.name}}{% else %}Logged Out{% endif %}{% endcapture %}
<script type="text/javascript">
  
  var line =      '- - - - - - - - - - - - - ',
    ul =          '-----------------',
    trpl =          '\n\n\n',
    dbl =           '\n\n',
    sgl =           '\n',
    headerTitle =   'Theme Information',
    loggedIn =    'Customer:      {{ cust }}',
    themeName =     'Theme Name:    {{ theme.name }}',
    pageTitle =     'Page Title:    {{ page_title | replace: "'","" }}',
    themeID =       'Theme ID:      {{ theme.id }}',
    templateName =  'Template:      {{ template }}';
  console.log(
    // line + 
    // trpl + 
    // headerTitle + sgl + ul + dbl + 
    // themeName + dbl + 
    // pageTitle + dbl +
    templateName + dbl
    // themeID +
    // themeID + dbl + 
    // loggedIn + 
    // trpl + 
    // line + 
    // sgl
  );

  console.time('counter');
  document.addEventListener("DOMContentLoaded", function() {

    setTimeout(function (argument) {
      LazyImages()
      document.body.classList.add('site-loaded');
    },0)

    updateHeightVar('.section-header', '--header-height')
    // updateHeightVar('.announcement-bar-section', '--announce-height')
    updateHeightVar('html', '--view-height')
    
    disableDuplicateCSS();
    disableDuplicateInlineCSS();

    var lazyElements = 'link.lazyload, iframe.lazyload';
    var lazyScripts  = 'script.lazyload';
    if (!Shopify.designMode) {
      checkAndLoad(lazyElements,true)
      // checkAndLoad(lazyScripts,false)
    } else {
      checkAndLoad(lazyElements,false) 
      // checkAndLoad(lazyScripts,false)
    }

  });

  function disableDuplicateCSS() {
    // disables duplicate css link files.
    var cssNodes    = document.getElementsByTagName("link"),
        foundNodes  = [],
        splitFirst  = 'assets/',
        splitLast   = '.css';
    for (const element of cssNodes) {
      var el        = element,
          elHref    = el.href,
          lnk       = elHref.split(splitFirst).pop().split(splitLast)[0];
      if (elHref.includes(splitFirst)) {
        if (foundNodes.includes(lnk)) {
          el.setAttribute('disabled', true);
        } else {
          foundNodes.push(lnk);
        }
      }
    }
  }

  function disableDuplicateInlineCSS() {
    // disables duplicate inline css style files.
    var cssNodes    = document.getElementsByTagName("style"),
        foundInlineCSS = [];
    for (const element of cssNodes) {
      var el        = element,
          elData    = el.dataset.id,
          lnk       = elData;
      if (typeof elData !== 'undefined') {
        if (foundInlineCSS.includes(lnk)) {
          // el.setAttribute('disabled', true);
          el.remove();
        } else {
          foundInlineCSS.push(lnk);
        }
      }
    }
  }

  function checkAndLoad(lazyElements,loadLazy) {
    var lazyItems = [].slice.call(document.querySelectorAll(lazyElements));
    if (loadLazy != false) {
      var visibleLinks = [];
      lazyItems.forEach(function(link, index) {
        var parLink = parentVisible(link);
        if (parentVisible(link)) {
          visibleLinks.push(parLink);
        } else {
          loadItem(link);
        }
      })
      itemIsVisible(visibleLinks,lazyItems);
    } else {
      loadAllItems(lazyItems) 
    }

    function parentVisible(elem) {
      var count,
          elemPar,
          nodes = [];
      nodes.push(elem);
      while( (elem.parentNode && elem.parentNode.nodeName != 'BODY' && elem.parentNode.nodeName != 'HTML' ) || count < 10 ) {
        count++
        nodes.unshift(elem.parentNode);
        elemPar = elem.parentNode;
        if ( elemPar ) {
          var styles = window.getComputedStyle(elemPar)
          if ( styles.display === 'none' || styles.visibility === 'hidden' || styles.opacity === '0' ) {
            return false;
          } else if (elemPar.nodeName == 'HEAD') {
            return elemPar;
            break
          } else {
            return elemPar;
            break
          }
        }
      }
      return elemPar;
    }
    
    function loadItem(el) {
      // el.media='all';
      if (el.nodeName == 'LINK') {
        el.href = el.dataset.href;
      } else {
        el.src = el.dataset.src;
      }
    }

    function itemIsVisible(arr, lazyItems) {
      if ("IntersectionObserver" in window && "IntersectionObserverEntry" in window && "intersectionRatio" in window.IntersectionObserverEntry.prototype) {
        let elObserver = new IntersectionObserver(function(entries, observer) {
          entries.forEach(function(entry) {
            var el = entry.target;
            // console.log(el)
            if ( entry.isIntersecting || ( window.scrollY > (el.offsetTop + el.offsetHeight) ) ) {
              var innerItems = el.querySelectorAll(lazyElements);
              innerItems.forEach(function(item){
                loadItem(item);
              })
              elObserver.unobserve(el);
            }
          });
        });
        arr.forEach(function(el) {
          elObserver.observe(el);
        });
      } else {
        console.log('observer failed')
        loadAllItems(lazyItems)
      }
    }

    function loadAllItems(lazyItems) {
      lazyItems.forEach(function(item, index) {
        loadItem(item);
        // console.log(item)
      });
    }

  }

  function LazyImages() {
    var lazyClass = 'lazyload',
        loadedClass = 'lazyloaded',
        ignoreClass = 'defer',
        lazyImages = [].slice.call(document.querySelectorAll('img.'+lazyClass+':not(.'+ignoreClass+')'));
    
    function cleanupImageAttributes(img) {
      // Transfer data attributes to regular attributes
      if (img.dataset.srcset) {
        img.setAttribute('srcset', img.dataset.srcset);
        img.removeAttribute('data-srcset');
      }
      if (img.dataset.sizes) {
        img.setAttribute('sizes', img.dataset.sizes);
        img.removeAttribute('data-sizes');
      }
      if (img.dataset.src) {
        img.src = img.dataset.src;
        img.removeAttribute('data-src');
      }
      // Remove other data attributes that are no longer needed
      img.removeAttribute('data-expand');
      img.removeAttribute('data-parent-fit');
    }

    // Add load event listener to all lazy images
    lazyImages.forEach(img => {
      img.addEventListener('load', () => {
        if (img.classList.contains(loadedClass)) {
          cleanupImageAttributes(img);
        }
      });
    });
    
    setTimeout(function () {
      if ("IntersectionObserver" in window) {
        let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              let lazyImage = entry.target;
              cleanupImageAttributes(lazyImage);
              lazyImage.classList.remove(lazyClass);
              lazyImage.classList.add(loadedClass);
              lazyImageObserver.unobserve(lazyImage);
            }
          });
        }, {
          rootMargin: '50px'
        });

        lazyImages.forEach(function(lazyImage) {
          lazyImageObserver.observe(lazyImage);
        });
      } else {
        // Fallback for older browsers
        var lazyloadThrottleTimeout;
        function lazyload () {
          if(lazyloadThrottleTimeout) {
            clearTimeout(lazyloadThrottleTimeout);
          }    
          lazyloadThrottleTimeout = setTimeout(function() {
            var scrollTop = window.pageYOffset;
            lazyImages.forEach(function(img) {
              if(img.offsetTop < (window.innerHeight + scrollTop)) {
                cleanupImageAttributes(img);
                img.classList.remove(lazyClass);
                img.classList.add(loadedClass);
              }
            });
            if(lazyImages.length == 0) { 
              document.removeEventListener("scroll", lazyload);
              window.removeEventListener("resize", lazyload);
              window.removeEventListener("orientationChange", lazyload);
            }
          }, 20);
        }
        document.addEventListener("scroll", lazyload);
        window.addEventListener("resize", lazyload);
        window.addEventListener("orientationChange", lazyload);
      }
    }, 100);
  }
  
  function updateHeightVar(el, v) {
    var prevH = 0;
    var itm = document.querySelector(el);

    runTwice()
    window.addEventListener('resize', runTwice);
    window.addEventListener('scroll', runTwice);

    function runTwice() {
      initH()
      setTimeout(function() {
        initH(true)
      }, 100);
    }

    function initH(force) {
      var H = itm.clientHeight;
      if (H != prevH || force == true) {
        // console.log('run') 
        // Then we set the value in the --header-height custom property to the root of the document
        document.documentElement.style.setProperty(v, `${H}px`);
        prevH = H;
      }
    }
  
  }








</script>

{% comment %} mega-menu-hover.js {% endcomment %}
<script src="{{ 'mega-menu-hover.js' | asset_url }}" defer="defer"></script>

<script src="{{ 'constants.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'pubsub.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'plugins.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'global.js' | asset_url }}" defer="defer"></script>

<svg xmlns="http://www.w3.org/2000/svg" class="hidden">
  <symbol id="icon-search" viewbox="0 0 18 19" fill="none">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.03 11.68A5.784 5.784 0 112.85 3.5a5.784 5.784 0 018.18 8.18zm.26 1.12a6.78 6.78 0 11.72-.7l5.4 5.4a.5.5 0 11-.71.7l-5.41-5.4z" fill="currentColor"/>
  </symbol>

  <symbol id="icon-reset" class="icon icon-close"  fill="none" viewBox="0 0 18 18" stroke="currentColor">
    <circle r="8.5" cy="9" cx="9" stroke-opacity="0.2"/>
    <path d="M6.82972 6.82915L1.17193 1.17097" stroke-linecap="round" stroke-linejoin="round" transform="translate(5 5)"/>
    <path d="M1.22896 6.88502L6.77288 1.11523" stroke-linecap="round" stroke-linejoin="round" transform="translate(5 5)"/>
  </symbol>

  <symbol id="icon-close" class="icon icon-close" fill="none" viewBox="0 0 18 17">
    <path d="M.865 15.978a.5.5 0 00.707.707l7.433-7.431 7.579 7.282a.501.501 0 00.846-.37.5.5 0 00-.153-.351L9.712 8.546l7.417-7.416a.5.5 0 10-.707-.708L8.991 7.853 1.413.573a.5.5 0 10-.693.72l7.563 7.268-7.418 7.417z" fill="currentColor">
  </symbol>
</svg>
